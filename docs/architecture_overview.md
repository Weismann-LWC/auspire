# Auspire 项目目录结构详解

## 📁 项目根目录

```
auspire/
├── handlers/           # HTTP请求处理器
├── middleware/         # 中间件(认证、日志等)
├── models/             # 数据模型定义
├── services/           # 核心业务逻辑服务
├── static/             # 静态资源文件
├── docs/               # 项目文档
├── .git/               # Git版本控制目录
├── .idea/              # JetBrains IDE配置目录
├── go.mod             # Go模块定义文件
├── go.sum             # 依赖版本锁定文件
├── main.go            # 应用程序入口文件
├── README.md          # 项目说明文档
├── LICENSE            # 开源许可证
└── .gitignore         # Git忽略文件配置
```

## 📁 Handlers 目录

处理HTTP请求的核心控制器。

```
handlers/
├── auth_handler.go    # 用户认证相关请求处理器
├── bazi_handler.go    # 八字计算相关请求处理器
└── handler.go         # 基础处理器接口定义
```

### auth_handler.go - 用户认证处理器

负责处理用户注册、登录、资料获取等认证相关功能。

**主要功能**:
- 用户注册接口实现
- 用户登录接口实现
- 用户资料获取接口实现
- JWT Token生成与验证

### bazi_handler.go - 八字计算处理器

负责处理所有八字计算相关的HTTP请求。

**主要功能**:
- 基础八字计算接口
- 喜用神计算接口
- 四柱八字综合分析接口
- 运势分析接口
- 人生阶段分析接口
- 健康检查接口

## 📁 Middleware 目录

HTTP中间件，处理请求前后的通用逻辑。

```
middleware/
└── auth.go            # JWT认证中间件
```

### auth.go - JWT认证中间件

负责验证请求中的JWT Token，保护需要认证的API接口。

**主要功能**:
- Token解析与验证
- 用户身份识别
- 权限控制

## 📁 Models 目录

数据模型定义，包括请求参数和响应数据结构。

```
models/
└── bazi.go            # 八字相关数据模型
```

### bazi.go - 八字数据模型

定义了所有与八字计算相关的数据结构。

**主要结构体**:
- `BaziRequest` - 八字计算请求参数
- `BaziColumn` - 八字四柱单列数据
- `BaziResponse` - 八字计算响应数据
- `XiYongShenRequest` - 喜用神计算请求参数
- `XiYongShenResult` - 喜用神计算结果
- `BaziyuceRequest` - 四柱八字综合分析请求参数
- `AnalysisStep` - 分析步骤数据结构
- `BaziyuceResult` - 四柱八字综合分析结果

## 📁 Services 目录

核心业务逻辑服务，每个命理概念对应一个独立服务模块。

```
services/
├── ai_client.go              # AI客户端服务
├── bazi_service.go           # 八字基础计算服务
├── baziyuce_service.go       # 四柱八字综合分析服务
├── canggan_service.go        # 藏干计算服务
├── fortune_service.go        # 运势分析服务
├── fuxing_service.go         # 副星计算服务
├── jwt_service.go            # JWT令牌服务
├── kongwang_service.go        # 空亡计算服务
├── nayin_service.go          # 纳音计算服务
├── shensha_service.go        # 神煞计算服务
├── shi_er_zhang_sheng.go     # 十二长生计算服务
├── user_service.go           # 用户管理服务
├── xingyun_service.go        # 星运计算服务
├── xiyongshen_anlyice.go     # 喜用神分析计算服务
├── xiyongshen_service.go     # 喜用神计算服务
├── zhuxing_service.go        # 主星(十神)计算服务
├── zizuo_service.go          # 自坐计算服务
└── solarterm/                # 节气相关服务目录
    └── solarterm.go          # 节气计算服务
```

### bazi_service.go - 八字基础计算服务

这是整个系统的核心服务，负责八字四柱的基础计算。

**主要功能**:
- 年柱、月柱、日柱、时柱的精确计算
- 集成所有专业服务模块的计算结果
- 提供完整的八字基础数据分析

### shi_er_zhang_sheng.go - 十二长生计算服务

实现传统命理学中的十二长生理论，这是八字分析的核心概念之一。

**主要功能**:
- 阳干顺排、阴干逆排的正确实现
- 每个天干在十二地支中的长生状态计算
- 提供长生状态查询接口

### zhuxing_service.go - 主星(十神)计算服务

计算天干间的十神关系，这是八字分析的基础。

**主要功能**:
- 比肩、劫财、食神、伤官等十神关系计算
- 基于五行相生相克关系的算法实现
- 阴阳属性判断

### canggan_service.go - 藏干计算服务

分析地支中隐藏的天干成分。

**主要功能**:
- 地支藏干对照表实现
- 藏干气质分析(本气、中气、余气)
- 藏干五行属性计算

### fuxing_service.go - 副星计算服务

基于藏干的十神分析，提供更深层次的命理洞察。

**主要功能**:
- 藏干十神关系计算
- 力量权重分析
- 复合影响评估

### nayin_service.go - 纳音计算服务

六十甲子的纳音五行计算。

**主要功能**:
- 纳音五行对照表
- 年柱纳音计算
- 纳音特性分析

### xingyun_service.go - 星运计算服务

分析地支在日主五行下的运程状态。

**主要功能**:
- 星运状态计算
- 运程分析
- 与十二长生的区别说明

### zizuo_service.go - 自坐计算服务

分析天干在所坐地支中的状态。

**主要功能**:
- 自坐状态计算
- 个人根基分析
- 地支支持度评估

### kongwang_service.go - 空亡计算服务

基于日柱的旬空计算。

**主要功能**:
- 旬空地支计算
- 空亡影响分析
- 能量缺失领域识别

### shensha_service.go - 神煞计算服务

各种神煞星的计算。

**主要功能**:
- 天乙贵人、太极贵人等吉神计算
- 驿马、灾煞等凶神计算
- 神煞影响力评估

### xiyongshen_service.go - 喜用神计算服务

喜用神的自动计算与分析。

**主要功能**:
- 日主强弱判断
- 五行得分计算
- 喜用神识别
- 计算逻辑说明

### baziyuce_service.go - 四柱八字综合分析服务

提供完整的八字综合分析。

**主要功能**:
- 五步分析法实现
- 传统命理学方法论应用
- 详细分析过程展示

### solarterm/ - 节气服务目录

处理与节气相关的计算逻辑。

**主要功能**:
- 二十四节气日期计算
- 节气与月柱对应关系
- 精确的月柱计算基础

## 📁 Static 目录

静态资源文件，包括HTML、CSS、JavaScript等前端文件。

```
static/
├── index.html            # 首页
├── paipan.html           # 排盘页面
├── paipan.css            # 排盘页面样式
├── paipan.js             # 排盘页面脚本
├── login.html            # 登录页面
├── register.html         # 注册页面
├── debug.html            # 调试页面
├── test.html             # 测试页面
└── test_paipan.html      # 排盘测试页面
```

### index.html - 首页

用户访问系统的第一个页面，提供八字计算入口。

**主要功能**:
- 用户输入姓名、出生日期、时间
- 触发八字计算
- 展示基础八字信息
- 提供进一步分析入口

### paipan.html - 排盘页面

专业的八字排盘展示页面。

**主要功能**:
- 完整的四柱八字展示
- 专业命理术语解释
- 美观的视觉设计
- 交互式元素

### paipan.css - 排盘页面样式

专业的命理主题样式设计。

**主要特色**:
- 深色主题设计
- 金色点缀元素
- 圆形五行图标
- 响应式布局

### paipan.js - 排盘页面脚本

处理页面交互和数据展示逻辑。

**主要功能**:
- AJAX请求处理
- 数据渲染
- 动画效果
- 用户交互

## 📁 Docs 目录

项目文档文件。

```
docs/
├── development_guide.md      # 开发指南
├── api_documentation.md      # API文档
└── architecture_overview.md  # 架构概览(即将创建)
```

## 📄 根目录重要文件

### main.go - 应用程序入口

整个应用程序的启动点。

**主要职责**:
- 初始化Gin框架
- 配置路由
- 启动HTTP服务器
- 环境变量配置

### go.mod - Go模块定义

定义项目的Go模块信息和依赖。

**主要内容**:
- 模块路径
- Go版本要求
- 依赖库列表

### go.sum - 依赖版本锁定

记录所有依赖的确切版本信息。

### README.md - 项目说明

项目的总体说明文档。

**包含内容**:
- 项目概述
- 核心特性
- 技术架构
- 快速开始指南
- API接口说明

### .gitignore - Git忽略配置

定义Git版本控制系统应该忽略的文件和目录。

## 📊 配置文件

### 环境变量

项目通过环境变量进行配置：

```bash
REDIS_ADDR=localhost:6379      # Redis地址
REDIS_PASSWORD=               # Redis密码
JWT_SECRET=auspire-secret-key # JWT密钥
JWT_ISSUER=auspire           # JWT发行者
```

## 🧩 设计理念

### 模块化设计

每个命理概念都被封装为独立的服务模块，遵循单一职责原则：

1. **高内聚**: 每个服务专注于特定的命理计算
2. **低耦合**: 服务间通过清晰的接口进行通信
3. **易扩展**: 添加新功能只需创建新的服务模块
4. **易测试**: 每个模块可以独立进行单元测试

### 分层架构

采用清晰的分层架构模式：

1. **表现层** (Handlers): 处理HTTP请求和响应
2. **业务层** (Services): 实现核心业务逻辑
3. **模型层** (Models): 定义数据结构
4. **中间件层** (Middleware): 处理横切关注点

### 数据驱动

所有命理知识都以数据表的形式存储和管理：

1. **配置数据**: 五行对照表、地支藏干表等
2. **规则数据**: 十神关系规则、神煞定位规则等
3. **分析逻辑**: 命理分析方法论

## 🚀 部署结构

### 开发环境

```
开发机器
├── Go编译器
├── Redis服务器
└── 项目源码
```

### 生产环境

```
生产服务器
├── Auspire可执行文件
├── 静态资源文件
├── 外部依赖(Redis)
└── 系统服务配置
```

## 📈 性能考虑

### 内存优化

1. **数据共享**: 使用包级别变量存储不变的基础数据
2. **计算复用**: 避免重复计算，缓存计算结果
3. **垃圾回收**: 合理管理对象生命周期

### 计算优化

1. **算法选择**: 使用高效的算法实现命理计算
2. **预计算**: 对不变数据进行预计算
3. **并发处理**: 合理利用Go的并发特性

## 🔧 维护指南

### 代码更新

1. **分支管理**: 使用Git分支进行功能开发
2. **代码审查**: 提交前进行代码审查
3. **测试覆盖**: 确保新功能有足够的测试覆盖

### 依赖管理

1. **版本锁定**: 使用go.mod和go.sum锁定依赖版本
2. **安全更新**: 定期检查依赖的安全更新
3. **兼容性**: 确保依赖更新不会破坏现有功能

### 监控与日志

1. **错误监控**: 记录并分析系统错误
2. **性能监控**: 监控API响应时间和系统资源使用
3. **用户行为**: 分析用户使用模式以优化体验

---

*本文档旨在帮助开发者快速了解项目结构和设计理念，更多详细信息请查阅各模块的具体实现。*